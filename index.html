<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Roulette</title>
    <!-- Compressed CSS -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/foundation-sites@6.6.3/dist/css/foundation.min.css" integrity="sha256-ogmFxjqiTMnZhxCqVmcqTvjfe1Y/ec4WaRj/aQPvn+I=" crossorigin="anonymous">
    <!-- Compressed JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/foundation-sites@6.6.3/dist/js/foundation.min.js" integrity="sha256-pRF3zifJRA9jXGv++b06qwtSqX1byFQOLjqa2PTEb2o=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
    
</head>
<body>
    <div class="top-bar">
        <div class="top-bar-left">
          <ul class="dropdown menu" data-dropdown-menu>
            <li class="menu-text">Restaurant Roulette</li>
          </ul>
        </div>
      </div>
        <!-- Location Input Form -->
    <div class="grid-x grid margin-x">
      <div id="form-container" class="cell medium-6">
        <h1>Let's Play Restaurant Roulette!</h1>
        <p>Having trouble deciding what to eat? Enter your city name and we'll calculate the perfect restaurant for you based on your current weather conditions. Never have trouble making dinner decisions again!</p>
        <form id="location-form"> 
          <label for="city-input">Enter Your City Here</label>
          <input type="text" id="city-input"><br>
          <input id="select-city" type="submit" value="GO!">
        </form>
      </div>
    </div>
    <!-- Location Input Return Section -->
    <div class="grid-x grid margin-x">
      <div id="results-container" class="cell medium-6">
        <h1>Where Should You Eat?</h1>
        <div id="cityinfo-div"></div>
        <h3>Your perfect restaurant:</h3>
        <div id="restaurantinfo-div"></div>
      </div>
    </div>

    
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript">

    function searchWeather(name) {
    
        var APIKey = "e79e860f1526eb9cc2572046fff7a30c"; // currently Alex's API key
        var userInput = $("#city-input").val();
        // building URL we need to access API
        var queryURL = "https://api.openweathermap.org/data/2.5/weather?q="+ userInput+"&appid=" + APIKey;

        $.ajax({ // Ajax function to access query
            url: queryURL,
            method: "GET"
        }).then(function(response) {

            var cityName = $("<div>").text(response.name); // creating the variable for city name
            var mainWeather = $("<div>").text(response.weather[0].main); // creating the name for the main weather data value

            $("#cityinfo-div").empty(); // emptying div
            $("#cityinfo-div").append(cityName, mainWeather); // appending the under inputted city name, and the corresponding main weather data value

        });
    }

    $("#select-city").on("click", function(event) { // creating the on click event to take in the user input city value
        event.preventDefault();
        var inputCity = $("#city-input").val().trim();

        searchWeather(inputCity);
        getCityID(inputCity);
    });

    function getCityID() { //function to extract cityID of user input from zomato api
        var userInput = $("#city-input").val();
        var queryURL = "https://developers.zomato.com/api/v2.1/cities?q="+userInput;


        $.ajax({
          url: queryURL,
          method: "GET",
          headers: {
            "Accept": "application/json",
            "user-key": "6be02bb0652cc2706beef4c9ffe979b1"
          }
        }).then(function(response) {
          console.log(response.location_suggestions[0].id);
          var userCity = response.location_suggestions[0].id; //grabs the first location suggestion's ID
          function getRestaurants(userCity) { //another function to serach for restaurants based on city ID
          var queryURL2 = "https://developers.zomato.com/api/v2.1/search?entity_id="+userCity+"&entity_type=city&count=100";
          console.log(queryURL2);

          $.ajax({
            url: queryURL2,
            method: "GET",
            headers: {
            "Accept": "application/json",
            "user-key": "6be02bb0652cc2706beef4c9ffe979b1"
            }
          }).then(function(response) {
            console.log(response);
            var randomInd = Math.floor(Math.random() * 20);
            var randomRestaurant = response.restaurants[randomInd].restaurant.name
            $("#restaurantinfo-div").append(randomRestaurant);
          })

        }
        
        getRestaurants(userCity);
        
        });
        
    }


</script>
</html>